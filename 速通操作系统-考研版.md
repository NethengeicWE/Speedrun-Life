# 速通操作系统-考研版
## 前言：
* 基于王道408-2025版复习资料，**千万不要去z-library上下载盗版**
* 善用LLM
* 对本科老师的吐槽详见原版

## C1 概述：
### 1.1 定！义！
* 定义：操作系统 (Operating System，OS)是指**控制和管理**整个计算机系统的硬件与软件资源，合理地组织、**调度**计算机的工作与资源的分配，进而为用户和其他软件**提供方便接口与环境**的程序集合。操作系统是计算机系统中最基本的系统软件。
* 特征：
    1. 并发：交替运行多个程序
    1. 共享：并发程序可以使用相同资源
    1. 虚拟：物理定义 -》逻辑定义
    1. 异步：时间不确定，保证相同结果
* 目标：  
    1. 管理：进程，存储器，文件，设备
    1. 接口：命令，程序
### 1.2 发展
* 历程
    1. 裸机，所有管理由人类进行
    1. 单/多批处理系统：
        * 单：逐个执行输入程序
        * 多：并发执行缓存程序
    1. 分时操作系统：多用户，时分复用
    1. 实时操作系统：现时，紧急任务
    1. 网络/分布式操作系统：分布式，并行性
    1. 个人操作系统：win，mac，linux...

### 1.3 运行环境
* 两种不同性质的程序：内核与应用
    > 权限不同：内核可执行特权指令，更底层
    1. 时钟管理：计时的最小单位
    1. 中断：打断当前任务去执行
        * 可以操作内核，通过**自陷**实现
        * 内部中断：程序故障/终止
        * 外部中断：P/S2键盘，可屏蔽
    1. 原语：理解为原子操作，可调用的公用小程序
    1. 系统数据结构管理：进程，存储器，设备管理
    1. 系统调用syscall：设备，文件，内存，进程管理，进程调度

### 1.4 结构
* 分层法：套娃
    * 优点：易调试，易扩充，易维护
    * 缺点：层间管理不佳
* **模块化**：分叉树
    * 内聚和外耦的平衡
* 宏内核：一揽子核心
* 微内核：仅保留核心功能与服务通讯，其余功能移交用户态
    > 保留功能：进程管理，底层存储管理（比如地址变换），中断（转发）
* 外核：虚拟机特有，为虚拟机分配物理资源，避免串味
### 1.5 引导-传统的BIOS（legacy）
1. BIOS：自检，加载引导程序
1. Bootloader：前513B是MBR，负责找到活动分区，进行第二段引导
1. GRUB（Linux）：读取配置文件，调整内核参数，加载linux内核

### 1.6 虚拟机分类
1. 宿主：在windows上开vmware
1. 架空：在windows上开wsl（Hyper-V），PVZ

## C2 进程与线程
### 2.1 定义
* 进程：程序加载到内存后，在CPU执行的过程
* 进程控制块PCB：描述程序和数据的数据结构（表）
    * 存储：
        1. 进程描述信息。进程标识符PID，用户标识符UID
        1. 进程控制和管理信息
        1. 进程优先级
        1. 资源分配清单
        1. 处理机相关信息（CPU上下文）
    * 性质
        * 动态：静止的数据被cpu处理
        * 并发：多个进程存于内存中，能在一段时间内同时运行
        * 独立：进程基本单位
        * 异步：由并发导致的时间不确定
* 程序段，数据段：进程的程序和数据
* 进程状态：
    * 运行态：正在由CPU核心处理
        * 子进程：继承父进程资源，结束时释放资源
    * 就绪态：存储在运存中，随时可运行
    * 阻塞态：等待缺乏运行所需的资源传达，所有资源齐全后进入就绪态
    * 终止态：不再运行，释放占用资源，结束子进程
    * 创建态：正在创建进程
        1. 分配进程标识号，创建PCB
        1. 分配资源：内存，文件，io资源，cpu时间等
        1. 初始化PCB：cpu状态信息和控制信息
* 进程通讯：
    * 共享存储：划分可共享的内存空间，需要同步互斥工具
    * 消息传递：利用操作系统提供的消息传递方法实现通信，分为直接（直达）/间接（转接）
    * 管道通信：特殊的共享文件：一端写一端出，单向传递。在linux中常用，一般会限制大小，如果管道为空则读取命令会导致进程进入阻塞。
* 进程和线程的区别：**一个进程可以包含多个线程**
    * 进程：操作系统层级的程序管理，拥有独立的地址空间，比较庞大
    * 线程：CPU层级的任务管理，共享地址空间，更加灵活，系统线程难以终止      
    线程也有与PCB类似的TCB：标识符，寄存器，优先级，存储区，堆栈指针
* 线程实现方式：权限不同——用户线程/内核线程
    * 用户级：内核线程使用用户空间线程库，无需模式切换，单独设置进程调度，不依赖操作系统，但一个线程阻塞会影响到整个进程
    * 内核级：小，切换快，内核支持运行，支持多线程，但是同进程下的线程切换开销大
    * 组合方式：综合实现，一个内核线程通过时分复用控制多个用户线程（后文提及）
* 多线程模型：
    * 一对多：一内核多用户，调度管理在用户，但是访问内核时会出现阻塞
    * 一对一：一内核一用户，调度在内核，无阻塞，高并发，但是内核开销大
    * 多对多：少量内核多个用户：综合上述优点
### 2.2 调度
* 定义：将算法高效分配给CPU进行运行